<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meetings - MentorMentee</title>
  <link rel="stylesheet" href="../css/modern-styles.css">
  <link rel="stylesheet" href="../css/mobile-optimizations.css">
  <script src="../js/notification-badge.js"></script>
  <script src="../js/mobile-menu.js" defer></script>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="container navbar-container">
      <a href="/" class="navbar-brand">MentorMentee</a>
      <ul class="nav-links">
        <li><a href="dashboard.html" class="nav-link">Dashboard</a></li>
        <li><a href="#" class="nav-link">Meetings</a></li>
        <li><a href="chat.html" class="nav-link">Messages</a></li>
        <li style="position: relative;">
          <a href="notifications.html" class="nav-link">
            Notifications
          </a>
        </li>
        <li><a href="profile.html" class="nav-link">Profile</a></li>
        <li><a href="../people.html" class="nav-link">People</a></li>
        <li><a href="#" id="logoutBtn" class="nav-link">Logout</a></li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="container">
    <div style="margin: 2rem 0;">
      <h1>Your Meetings</h1>
      <p>View your scheduled mentoring sessions</p>
    </div>

    <!-- Upcoming Meetings -->
    <div class="card">
      <h3>Upcoming Meetings</h3>
      <div id="upcomingMeetings">
        <p style="text-align: center; color: var(--gray); padding: 2rem;">No upcoming meetings scheduled</p>
      </div>
    </div>

    <!-- Past Meetings -->
    <div class="card">
      <h3>Past Meetings</h3>
      <div id="pastMeetings">
        <p style="text-align: center; color: var(--gray); padding: 2rem;">No past meetings</p>
      </div>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const token = localStorage.getItem('token');
      if (!token) {
        alert('Please login first');
        window.location.href = 'login.html';
        return;
      }

      // Load meetings
      loadMeetings();
      
      // Logout button
      document.getElementById('logoutBtn').addEventListener('click', function(e) {
        e.preventDefault();
        if (confirm('Are you sure you want to logout?')) {
          localStorage.removeItem('token');
          localStorage.removeItem('userRole');
          window.location.href = '/';
        }
      });
    });

    async function loadMeetings() {
      const token = localStorage.getItem('token');
      try {
        const response = await fetch('/api/meetings', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        
        if (response.ok) {
          const meetings = await response.json();
          displayMeetings(meetings);
        }
      } catch (error) {
        console.error('Error loading meetings:', error);
      }
    }

    function displayMeetings(meetings) {
      const now = new Date();
      const upcoming = meetings.filter(m => new Date(m.date) >= now);
      const past = meetings.filter(m => new Date(m.date) < now);

      // Display upcoming meetings
      const upcomingDiv = document.getElementById('upcomingMeetings');
      if (upcoming.length === 0) {
        upcomingDiv.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 2rem;">No upcoming meetings scheduled</p>';
      } else {
        upcomingDiv.innerHTML = upcoming.map(meeting => createMeetingCard(meeting, false)).join('');
      }

      // Display past meetings
      const pastDiv = document.getElementById('pastMeetings');
      if (past.length === 0) {
        pastDiv.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 2rem;">No past meetings</p>';
      } else {
        pastDiv.innerHTML = past.map(meeting => createMeetingCard(meeting, true)).join('');
      }
    }

    function createMeetingCard(meeting, isPast) {
      const date = new Date(meeting.date);
      const dateStr = formatDateTime(date);
      const mentorName = meeting.mentor?.name || meeting.mentor?.username || 'Mentor';
      
      return `
        <div class="meeting-card">
          <div class="meeting-header" style="${isPast ? 'background: #e2e8f0; color: var(--dark);' : ''}">
            <h4>${meeting.title}</h4>
            <p style="margin: 0; opacity: 0.9;">${dateStr}</p>
          </div>
          <div class="meeting-body">
            <p>${meeting.description || 'No description provided'}</p>
            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
              <span style="background: rgba(67, 97, 238, 0.1); color: var(--primary); padding: 0.25rem 0.5rem; border-radius: var(--radius); font-size: 0.8rem;">${meeting.duration} min</span>
              ${meeting.status ? `<span style="background: rgba(67, 97, 238, 0.1); color: var(--primary); padding: 0.25rem 0.5rem; border-radius: var(--radius); font-size: 0.8rem;">${meeting.status}</span>` : ''}
            </div>
          </div>
          <div class="meeting-footer">
            <div>
              <p style="margin: 0; font-weight: 600;">${mentorName}</p>
              <p style="margin: 0; font-size: 0.9rem; color: var(--gray);">Mentor</p>
            </div>
            <div>
              ${meeting.meetingLink && !isPast ? `<a href="${meeting.meetingLink}" target="_blank" class="btn btn-secondary btn-sm">Join Meeting</a>` : ''}
            </div>
          </div>
        </div>
      `;
    }

    function formatDateTime(date) {
      const options = { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric', 
        hour: '2-digit', 
        minute: '2-digit' 
      };
      return date.toLocaleDateString('en-US', options);
    }
  </script>
</body>
</html>